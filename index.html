<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pretoria Weather</title>
    <style>
        /* Glassmorphism base */
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 0.5s ease;
        }
        
        .container {
            backdrop-filter: blur(15px);
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 2rem;
            margin: 1rem;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);
            color: white;
            width: 90%;
            max-width: 800px;
            animation: fadeIn 0.5s ease;
        }
        
        /* Weather backgrounds */
        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            transition: all 0.5s ease;
        }
        
        .clear {
            background: linear-gradient(to bottom right, #87CEEB, #87CEEB);
        }
        
        .cloudy {
            background: linear-gradient(to bottom right, #A9A9A9, #D3D3D3);
        }
        
        .rain {
            background: linear-gradient(to bottom right, #4682B4, #5F9EA0);
        }
        
        .storm {
            background: linear-gradient(to bottom right, #2F4F4F, #000080);
        }
        
        .snow {
            background: linear-gradient(to bottom right, #F0FFFF, #F0FFFF);
        }
        
        .night {
            background: linear-gradient(to bottom right, #000080, #000000);
            animation: stars 5s ease-in-out infinite;
        }
        
        /* Weather animations */
        @keyframes rain {
            0% { transform: translateY(0); }
            100% { transform: translateY(100vh); }
        }
        
        .raindrop {
            position: absolute;
            width: 2px;
            height: 10px;
            background: rgba(255, 255, 255, 0.6);
            animation: rain 1s linear infinite;
        }
        
        @keyframes stars {
            0%, 100% { background-color: #000080; }
            50% { background-color: #000033; }
        }
        
        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            opacity: 0.6;
        }
        
        @keyframes sun {
            0% { transform: scale(1) rotate(0deg); }
            100% { transform: scale(1.1) rotate(360deg); }
        }
        
        .sun-rays {
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 5px solid rgba(255, 255, 0, 0.6);
            animation: sun 5s linear infinite;
        }
        
        @keyframes lightning {
            0%, 98%, 100% { opacity: 0; }
            95% { opacity: 1; }
        }
        
        .lightning {
            position: absolute;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.3);
            animation: lightning 1s infinite;
        }
        
        /* Forecast cards */
        .forecast-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .forecast-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .forecast-card:hover {
            transform: scale(1.05);
        }
        
        /* Hourly forecast scroll */
        .hourly-container {
            overflow-x: auto;
            white-space: nowrap;
            margin-top: 1rem;
            padding: 0.5rem;
        }
        
        .hourly-item {
            display: inline-block;
            width: 80px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 0.5rem;
            margin-right: 0.5rem;
            text-align: center;
        }
        
        /* Responsive adjustments */
        @media (max-width: 600px) {
            .container {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <div id="background" class="background clear"></div>
    <div class="container">
        <h1>Pretoria Weather</h1>
        <div id="current">
            <p>Loading current weather...</p>
        </div>
        <div class="hourly-container">
            <h2>Hourly Forecast</h2>
            <div id="hourly"></div>
        </div>
        <div class="forecast-container">
            <h2>7-Day Forecast</h2>
            <div id="forecast"></div>
        </div>
    </div>
    <script>
        const API_URL = "https://api.open-meteo.com/v1/forecast?latitude=-25.7479&longitude=28.2293&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,wind_speed_10m,wind_direction_10m,uv_index&hourly=temperature_2m,weather_code&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_probability_max,sunrise,sunset&timezone=Africa/Johannesburg&forecast_days=7";

        function getWeatherIcon(code) {
            const icons = {
                0: 'â˜€ï¸', 1: 'ðŸŒ¤ï¸', 2: 'â›…', 3: 'â˜ï¸', 
                45: 'ðŸŒ«ï¸', 48: 'ðŸŒ«ï¸', 
                51: 'ðŸŒ§ï¸', 53: 'ðŸŒ§ï¸', 55: 'ðŸŒ§ï¸',
                61: 'ðŸŒ§ï¸', 63: 'ðŸŒ§ï¸', 65: 'ðŸŒ§ï¸',
                71: 'â„ï¸', 73: 'â„ï¸', 75: 'â„ï¸',
                80: 'ðŸŒ¦ï¸', 81: 'ðŸŒ¦ï¸', 82: 'ðŸŒ¦ï¸',
                95: 'â›ˆï¸', 96: 'â›ˆï¸', 99: 'â›ˆï¸'
            };
            return icons[code] || 'ðŸŒ¡ï¸';
        }

        function updateBackground(code) {
            const bg = document.getElementById('background');
            bg.className = 'background'; // Reset
            
            if (code === 0 || code === 1) bg.classList.add('clear');
            else if (code === 2) bg.classList.add('cloudy');
            else if ([3, 45, 48, 51, 53, 55, 61, 63, 65].includes(code)) bg.classList.add('rain');
            else if ([71, 73, 75, 80, 81, 82].includes(code)) bg.classList.add('snow');
            else if ([95, 96, 99].includes(code)) bg.classList.add('storm');
            else bg.classList.add('clear');
        }

        function updateDayNight(sunrise, sunset) {
            const now = new Date();
            const sunRise = new Date(sunrise);
            const sunSet = new Date(sunset);
            const bg = document.getElementById('background');
            
            if (now > sunRise && now < sunSet) {
                // Day time
                if (!bg.classList.contains('clear') && !bg.classList.contains('cloudy') && !bg.classList.contains('rain') && !bg.classList.contains('snow')) {
                    bg.classList.add('clear');
                }
            } else {
                bg.classList.add('night');
            }
        }

        async function fetchWeather() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error('Network response was not ok');
                const data = await response.json();
                
                // Update current weather
                const current = document.getElementById('current');
                current.innerHTML = `
                    <h2>Current Weather</h2>
                    <p><strong>Temperature:</strong> ${data.current.temperature_2m}Â°C</p>
                    <p><strong>Feels Like:</strong> ${data.current.apparent_temperature}Â°C</p>
                    <p><strong>Humidity:</strong> ${data.current.relative_humidity_2m}%</p>
                    <p><strong>Wind:</strong> ${data.current.wind_speed_10m} m/s ${getWindDirection(data.current.wind_direction_10m)}</p>
                    <p><strong>UV Index:</strong> ${data.current.uv_index}</p>
                    <p><strong>Weather:</strong> ${getWeatherIcon(data.current.weather_code)}</p>
                    <p><strong>Last Updated:</strong> ${new Date(data.current.time).toLocaleTimeString()}</p>
                `;
                
                // Update hourly forecast
                const hourly = document.getElementById('hourly');
                hourly.innerHTML = data.hourly.temperature_2m.slice(0, 12).map((temp, i) => {
                    return `<div class="hourly-item">
                        <p>${new Date(data.hourly.time[i]).getHours()}:00</p>
                        <p>${temp}Â°C</p>
                        <p>${getWeatherIcon(data.hourly.weather_code[i])}</p>
                    </div>`;
                }).join('');
                
                // Update 7-day forecast
                const forecast = document.getElementById('forecast');
                forecast.innerHTML = data.daily.temperature_2m_max.map((max, i) => {
                    const min = data.daily.temperature_2m_min[i];
                    return `<div class="forecast-card">
                        <p><strong>${new Date(data.daily.time[i]).toLocaleDateString('en-US', { weekday: 'short' })}</strong></p>
                        <p>${getWeatherIcon(data.daily.weather_code[i])}</p>
                        <p>High: ${max}Â°C</p>
                        <p>Low: ${min}Â°C</p>
                        <p>Precip: ${data.daily.precipitation_probability_max[i]}%</p>
                    </div>`;
                }).join('');
                
                // Update background
                updateBackground(data.current.weather_code);
                updateDayNight(data.daily.sunrise[0], data.daily.sunset[0]);
                
            } catch (error) {
                console.error('Error fetching weather:', error);
                document.getElementById('current').innerHTML = '<p>Error loading weather data. Please try again later.</p>';
            }
        }

        function getWindDirection(degrees) {
            const directions = ['N', 'NE', 'E', 'SE', 'S', 'SW', 'W', 'NW'];
            const index = Math.round(degrees / 45) % 8;
            return directions[index];
        }

        // Initialize
        fetchWeather();
        setInterval(fetchWeather, 15 * 60 * 1000); // Auto-refresh every 15 minutes
    </script>
</body>
</html>